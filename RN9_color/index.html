<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL 3D RN9</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { width: 100vw; height: 100vh; display: block; }
    </style>
</head>
<body>
    <canvas id="gl-canvas"></canvas>

    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec3 a_position;
        attribute vec3 a_normal;
        attribute vec3 a_color; 

        uniform mat4 u_projectionMatrix;
        uniform mat4 u_viewMatrix;
        uniform mat4 u_modelMatrix;
        uniform mat4 u_normalMatrix;

        varying vec3 v_normal;
        varying vec3 v_vertexPosition;
        varying vec3 v_color;

        void main() {
            vec4 worldPosition = u_modelMatrix * vec4(a_position, 1.0);
            v_vertexPosition = worldPosition.xyz;

            v_normal = normalize((u_normalMatrix * vec4(a_normal, 0.0)).xyz);
            v_color = a_color;
            
            gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        varying vec3 v_normal;
        varying vec3 v_vertexPosition;
        varying vec3 v_color;

        //cahaya
        uniform vec3 u_lightPosition;
        uniform vec3 u_lightColor;
        uniform vec3 u_ambientLight;

        //material
        uniform vec3 u_materialAmbient;
        uniform vec3 u_materialSpecular;
        uniform float u_materialShininess;

        uniform vec3 u_viewPosition;

        void main() {
            vec3 normal = normalize(v_normal);
            vec3 lightDirection = normalize(u_lightPosition - v_vertexPosition);
            vec3 viewDirection = normalize(u_viewPosition - v_vertexPosition);

            //ambient component
            vec3 ambient = u_ambientLight * v_color;

            //diffuse cmponent
            float diff = max(dot(normal, lightDirection), 0.0);
            vec3 diffuse = u_lightColor * v_color * diff; // DIUBAH: Gunakan v_color

            //specular component
            vec3 reflectDirection = normalize(reflect(-lightDirection, normal));
            float spec = pow(max(dot(viewDirection, reflectDirection), 0.0), u_materialShininess);
            vec3 specular = u_lightColor * u_materialSpecular * spec;

            vec3 finalColor = ambient + diffuse + specular;
            
            gl_FragColor = vec4(finalColor, 1.0);
        }
    </script>

    <script type="module" src="main.js"></script>
</body>
</html>